@using RikaWebApp.ViewModels
@model ProductViewModel

<div class="product-details">
    <div class="product-image">
        @if (Model.Images != null && Model.Images.Count > 1)
        {
            <!-- Bootstrap karusell -->
            <div id="productCarousel" class="carousel slide" data-ride="carousel">
               
                <ol class="carousel-indicators">
                    @for (int i = 0; i < Model.Images.Count; i++)
                    {
                        <li data-target="#productCarousel" data-slide-to="@i" class="@(i == 0 ? "active" : "")"></li>
                    }
                </ol>

                <!-- karusellbilder -->
                <div class="carousel-inner" style="margin-top: 2rem;">
                    @for (int i = 0; i < Model.Images.Count; i++)
                    {
                        <div class="carousel-item @(i == 0 ? "active" : "")">
                            <img class="d-block w-100" src="@Model.Images[i]" alt="Product Image" style="max-width:300px; max-height:300px;">
                        </div>
                    }
                </div>

                <!-- Controls                    INLINE STYLING ta bort sen -->
                <a class="carousel-control-prev" style="width: 80px; height:80px; background-size:80px 80px; background-color: limegreen;" href="#productCarousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" style="width: 80px; height:80px; background-size:80px 80px; background-color: blue;" href="#productCarousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        }
        else if (Model.Images != null && Model.Images.Any())
        {
            <!-- visa bara 1 bild om det inte finns fler -->
            <img src="@Model.Images.First()" alt="@Model.Name" style="max-width:300px; max-height:300px;" />
        }
    </div>

    <h1>@Model.Name</h1>
    <h2>@Model.Description</h2>

    <h4>Betyg:</h4>
    <div class="rating">
        @if (Model.Reviews != null && Model.Reviews.Any())
        {
            var averageRating = Model.Reviews.Average(r => r.Rating);
            int fullStars = (int)averageRating;

            for (int i = 1; i <= 5; i++)
            {
                if (i <= fullStars)
                {
                    <i class="fas fa-star"></i>
                }
                else
                {
                    <i class="far fa-star"></i>
                }
            }
        }
        else
        {
            <p>Inga recensioner tillgängliga.</p>
        }
    </div>

    <h4>Available Sizes:</h4>
    <div class="size-selection">
        @if (Model.Variants != null && Model.Variants.Any())
        {
            @foreach (var variant in Model.Variants.DistinctBy(v => v.Size))
            {
                <span>@variant.Size</span>
            }
        }
    </div>

    <h4>Available Colors:</h4>
    <div class="color-selection">
        @if (Model.Variants != null && Model.Variants.Any())
        {
            @foreach (var variant in Model.Variants.DistinctBy(v => v.Color))
            {
                <button class="btn-round" style="background-color: @variant.Color;" title="@variant.Color">
                </button>
            }
        }
        else
        {
            <p>Inga färger tillgängliga.</p>
        }
    </div>

    <div class="stock">
        <h4>Stock Availability:</h4>
        <p id="stock-status">
            
            @if (Model.Variants != null && Model.Variants.Any())
            {
                <p>Stock level: @Model.Variants.FirstOrDefault()?.Stock</p>
                var firstVariant = Model.Variants.First();
                if (firstVariant.Stock > 0)
                {
                    <span>Available in stock</span>
                }
                else
                {
                    <span>Out of stock</span>
                }
            }
            else
            {
                <span>Inga varianter tillgängliga.</span>
            }
        </p>
    </div>

    <h3>Total Price: $@Model.Variants.FirstOrDefault()?.Price</h3>
    <button>Add to cart</button>
</div>